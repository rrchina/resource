window.datePicker=(function(){var a=function(){this.gearDate;this.minY=1900;this.minM=1;this.minD=1;this.maxY=2099;this.maxM=12;this.maxD=31;this.value=""};a.prototype={init:function(e){this.type=e.type;this.trigger=document.querySelector(e.trigger);if(this.trigger.getAttribute("data-lcalendar")!=null){var b=this.trigger.getAttribute("data-lcalendar").split(",");var d=b[0].split("-");this.minY=~~d[0];this.minM=~~d[1];this.minD=~~d[2];var c=b[1].split("-");this.maxY=~~c[0];this.maxM=~~c[1];this.maxD=~~c[2]}if(e.minDate){var d=e.minDate.split("-");this.minY=~~d[0];this.minM=~~d[1];this.minD=~~d[2]}if(e.maxDate){var c=e.maxDate.split("-");this.maxY=~~c[0];this.maxM=~~c[1];this.maxD=~~c[2]}this.onClose=e.onClose;this.onSubmit=e.onSubmit;this.onChange=e.onChange;this.bindEvent(this.type)},bindEvent:function(A){var b=this;var p=false,o=false;var u;function q(F){b.gearDate=document.createElement("div");b.gearDate.className="gearDate";b.gearDate.innerHTML='<div class="date_ctrl slideInUp"><div class="date_btn_box"><div class="date_btn lcalendar_cancel">取消</div><div class="date_btn lcalendar_finish">确定</div></div><div class="date_roll_mask"><div class="date_roll"><div><div class="gear date_yy" data-datetype="date_yy"></div><div class="date_grid"><div>年</div></div></div><div><div class="gear date_mm" data-datetype="date_mm"></div><div class="date_grid"><div>月</div></div></div><div><div class="gear date_dd" data-datetype="date_dd"></div><div class="date_grid"><div>日</div></div></div></div></div></div><div class="date_bg" style="width:100%;height:100%;"></div>';document.body.appendChild(b.gearDate);e();var H=b.gearDate.querySelector(".lcalendar_cancel");H.addEventListener("touchstart",d);var I=b.gearDate.querySelector(".lcalendar_finish");I.addEventListener("touchstart",g);var G=b.gearDate.querySelector(".date_bg");G.addEventListener("click",d);var E=b.gearDate.querySelector(".date_yy");var D=b.gearDate.querySelector(".date_mm");var C=b.gearDate.querySelector(".date_dd");E.addEventListener("touchstart",n);D.addEventListener("touchstart",n);C.addEventListener("touchstart",n);E.addEventListener("touchmove",l);D.addEventListener("touchmove",l);C.addEventListener("touchmove",l);E.addEventListener("touchend",k);D.addEventListener("touchend",k);C.addEventListener("touchend",k);H.addEventListener("click",d);I.addEventListener("click",g);E.addEventListener("mousedown",n);D.addEventListener("mousedown",n);C.addEventListener("mousedown",n);E.addEventListener("mousemove",l);D.addEventListener("mousemove",l);C.addEventListener("mousemove",l);E.addEventListener("mouseup",k);D.addEventListener("mouseup",k);C.addEventListener("mouseup",k);b.gearDate.querySelector(".date_roll_mask").addEventListener("mouseleave",m);b.gearDate.querySelector(".date_roll_mask").addEventListener("mouseup",m)}function e(){var C=new Date();var D={yy:C.getYear(),mm:C.getMonth(),dd:C.getDate()-1};if(/^\d{4}-\d{1,2}-\d{1,2}$/.test(b.trigger.value)){rs=b.trigger.value.match(/(^|-)\d{1,4}/g);D.yy=rs[0]-b.minY;D.mm=rs[1].replace(/-/g,"")-1;D.dd=rs[2].replace(/-/g,"")-1}else{D.yy=D.yy+1900-b.minY}b.gearDate.querySelector(".date_yy").setAttribute("val",D.yy);b.gearDate.querySelector(".date_mm").setAttribute("val",D.mm);b.gearDate.querySelector(".date_dd").setAttribute("val",D.dd);w()}function t(E){b.gearDate=document.createElement("div");b.gearDate.className="gearDate";b.gearDate.innerHTML='<div class="date_ctrl slideInUp"><div class="date_btn_box"><div class="date_btn lcalendar_cancel">取消</div><div class="date_btn lcalendar_finish">确定</div></div><div class="date_roll_mask"><div class="ym_roll"><div><div class="gear date_yy" data-datetype="date_yy"></div><div class="date_grid"><div>年</div></div></div><div><div class="gear date_mm" data-datetype="date_mm"></div><div class="date_grid"><div>月</div></div></div></div></div></div><div class="date_bg" style="width:100%;height:100%;"></div>';document.body.appendChild(b.gearDate);B();var G=b.gearDate.querySelector(".lcalendar_cancel");G.addEventListener("touchstart",d);var H=b.gearDate.querySelector(".lcalendar_finish");H.addEventListener("touchstart",j);var F=b.gearDate.querySelector(".date_bg");F.addEventListener("click",d);var D=b.gearDate.querySelector(".date_yy");var C=b.gearDate.querySelector(".date_mm");D.addEventListener("touchstart",n);C.addEventListener("touchstart",n);D.addEventListener("touchmove",l);C.addEventListener("touchmove",l);D.addEventListener("touchend",k);C.addEventListener("touchend",k);G.addEventListener("click",d);H.addEventListener("click",j);D.addEventListener("mousedown",n);C.addEventListener("mousedown",n);D.addEventListener("mousemove",l);C.addEventListener("mousemove",l);D.addEventListener("mouseup",k);C.addEventListener("mouseup",k);b.gearDate.querySelector(".date_roll_mask").addEventListener("mouseleave",m);b.gearDate.querySelector(".date_roll_mask").addEventListener("mouseup",m)}function B(){var C=new Date();var D={yy:C.getYear(),mm:C.getMonth()};if(/^\d{4}-\d{1,2}$/.test(b.trigger.value)){rs=b.trigger.value.match(/(^|-)\d{1,4}/g);D.yy=rs[0]-b.minY;D.mm=rs[1].replace(/-/g,"")-1}else{D.yy=D.yy+1900-b.minY}b.gearDate.querySelector(".date_yy").setAttribute("val",D.yy);b.gearDate.querySelector(".date_mm").setAttribute("val",D.mm);w()}function r(F){b.gearDate=document.createElement("div");b.gearDate.className="gearDatetime";b.gearDate.innerHTML='<div class="date_ctrl slideInUp"><div class="date_btn_box"><div class="date_btn lcalendar_cancel">取消</div><div class="date_btn lcalendar_finish">确定</div></div><div class="date_roll_mask"><div class="datetime_roll"><div><div class="gear date_yy" data-datetype="date_yy"></div><div class="date_grid"><div>年</div></div></div><div><div class="gear date_mm" data-datetype="date_mm"></div><div class="date_grid"><div>月</div></div></div><div><div class="gear date_dd" data-datetype="date_dd"></div><div class="date_grid"><div>日</div></div></div><div><div class="gear time_hh" data-datetype="time_hh"></div><div class="date_grid"><div>时</div></div></div><div><div class="gear time_mm" data-datetype="time_mm"></div><div class="date_grid"><div>分</div></div></div></div></div></div><div class="date_bg" style="width:100%;height:100%;"></div>';document.body.appendChild(b.gearDate);f();var H=b.gearDate.querySelector(".lcalendar_cancel");H.addEventListener("touchstart",d);var I=b.gearDate.querySelector(".lcalendar_finish");I.addEventListener("touchstart",h);var G=b.gearDate.querySelector(".date_bg");G.addEventListener("click",d);var E=b.gearDate.querySelector(".date_yy");var D=b.gearDate.querySelector(".date_mm");var C=b.gearDate.querySelector(".date_dd");var J=b.gearDate.querySelector(".time_hh");var K=b.gearDate.querySelector(".time_mm");E.addEventListener("touchstart",n);D.addEventListener("touchstart",n);C.addEventListener("touchstart",n);J.addEventListener("touchstart",n);K.addEventListener("touchstart",n);E.addEventListener("touchmove",l);D.addEventListener("touchmove",l);C.addEventListener("touchmove",l);J.addEventListener("touchmove",l);K.addEventListener("touchmove",l);E.addEventListener("touchend",k);D.addEventListener("touchend",k);C.addEventListener("touchend",k);J.addEventListener("touchend",k);K.addEventListener("touchend",k);H.addEventListener("click",d);I.addEventListener("click",h);E.addEventListener("mousedown",n);D.addEventListener("mousedown",n);C.addEventListener("mousedown",n);J.addEventListener("mousedown",n);K.addEventListener("mousedown",n);E.addEventListener("mousemove",l);D.addEventListener("mousemove",l);C.addEventListener("mousemove",l);J.addEventListener("mousemove",l);K.addEventListener("mousemove",l);E.addEventListener("mouseup",k);D.addEventListener("mouseup",k);C.addEventListener("mouseup",k);J.addEventListener("mouseup",k);K.addEventListener("mouseup",k);b.gearDate.querySelector(".date_roll_mask").addEventListener("mouseleave",m);b.gearDate.querySelector(".date_roll_mask").addEventListener("mouseup",m)}function f(){var C=new Date();var D={yy:C.getYear(),mm:C.getMonth(),dd:C.getDate()-1,hh:C.getHours(),mi:C.getMinutes()};if(/^\d{4}-\d{1,2}-\d{1,2}\s\d{2}:\d{2}$/.test(b.trigger.value)){rs=b.trigger.value.match(/(^|-|\s|:)\d{1,4}/g);D.yy=rs[0]-b.minY;D.mm=rs[1].replace(/-/g,"")-1;D.dd=rs[2].replace(/-/g,"")-1;D.hh=parseInt(rs[3].replace(/\s0?/g,""));D.mi=parseInt(rs[4].replace(/:0?/g,""))}else{D.yy=D.yy+1900-b.minY}b.gearDate.querySelector(".date_yy").setAttribute("val",D.yy);b.gearDate.querySelector(".date_mm").setAttribute("val",D.mm);b.gearDate.querySelector(".date_dd").setAttribute("val",D.dd);w();b.gearDate.querySelector(".time_hh").setAttribute("val",D.hh);b.gearDate.querySelector(".time_mm").setAttribute("val",D.mi);y()}function s(C){b.gearDate=document.createElement("div");b.gearDate.className="gearDate";b.gearDate.innerHTML='<div class="date_ctrl slideInUp"><div class="date_btn_box"><div class="date_btn lcalendar_cancel">取消</div><div class="date_btn lcalendar_finish">确定</div></div><div class="date_roll_mask"><div class="time_roll"><div><div class="gear time_hh" data-datetype="time_hh"></div><div class="date_grid"><div>时</div></div></div><div><div class="gear time_mm" data-datetype="time_mm"></div><div class="date_grid"><div>分</div></div></div></div></div></div><div class="date_bg" style="width:100%;height:100%;"></div>';document.body.appendChild(b.gearDate);z();var E=b.gearDate.querySelector(".lcalendar_cancel");E.addEventListener("touchstart",d);var F=b.gearDate.querySelector(".lcalendar_finish");F.addEventListener("touchstart",i);var D=b.gearDate.querySelector(".date_bg");D.addEventListener("click",d);var G=b.gearDate.querySelector(".time_hh");var H=b.gearDate.querySelector(".time_mm");G.addEventListener("touchstart",n);H.addEventListener("touchstart",n);G.addEventListener("touchmove",l);H.addEventListener("touchmove",l);G.addEventListener("touchend",k);H.addEventListener("touchend",k);E.addEventListener("click",d);F.addEventListener("click",i);G.addEventListener("mousedown",n);H.addEventListener("mousedown",n);G.addEventListener("mousemove",l);H.addEventListener("mousemove",l);G.addEventListener("mouseup",k);H.addEventListener("mouseup",k);b.gearDate.querySelector(".date_roll_mask").addEventListener("mouseleave",m);b.gearDate.querySelector(".date_roll_mask").addEventListener("mouseup",m)}function z(){var C=new Date();var D={hh:C.getHours(),mm:C.getMinutes()};if(/^\d{2}:\d{2}$/.test(b.trigger.value)){rs=b.trigger.value.match(/(^|:)\d{2}/g);D.hh=parseInt(rs[0].replace(/^0?/g,""));D.mm=parseInt(rs[1].replace(/:0?/g,""))}b.gearDate.querySelector(".time_hh").setAttribute("val",D.hh);b.gearDate.querySelector(".time_mm").setAttribute("val",D.mm);y()}function w(){var P=b.maxY-b.minY+1;var E=b.gearDate.querySelector(".date_yy");var G="";if(E&&E.getAttribute("val")){var R=parseInt(E.getAttribute("val"));for(var O=0;O<=P-1;O++){G+="<div class='tooth'>"+(b.minY+O)+"</div>"}E.innerHTML=G;var Q=Math.floor(parseFloat(E.getAttribute("top")));if(!isNaN(Q)){Q%2==0?(Q=Q):(Q=Q+1);Q>8&&(Q=8);var M=8-(P-1)*2;Q<M&&(Q=M);E.style.transform="translate3d(0,"+Q+"em,0)";E.setAttribute("top",Q+"em");R=Math.abs(Q-8)/2;E.setAttribute("val",R)}else{E.style.transform="translate3d(0,"+(8-R*2)+"em,0)";E.setAttribute("top",8-R*2+"em")}}else{return}var D=b.gearDate.querySelector(".date_mm");if(D&&D.getAttribute("val")){G="";var N=parseInt(D.getAttribute("val"));var I=11;var L=0;if(R==P-1){I=b.maxM-1}if(R==0){L=b.minM-1}for(var O=0;O<I-L+1;O++){G+="<div class='tooth'>"+(L+O+1)+"</div>"}D.innerHTML=G;if(N>I){N=I;D.setAttribute("val",N)}else{if(N<L){N=I;D.setAttribute("val",N)}}D.style.transform="translate3d(0,"+(8-(N-L)*2)+"em,0)";D.setAttribute("top",8-(N-L)*2+"em")}else{return}var C=b.gearDate.querySelector(".date_dd");if(C&&C.getAttribute("val")){G="";var F=parseInt(C.getAttribute("val"));var J=c(R,N);var H=J-1;var K=0;if(R==P-1&&b.maxM==N+1){H=b.maxD-1}if(R==0&&b.minM==N+1){K=b.minD-1}for(var O=0;O<H-K+1;O++){G+="<div class='tooth'>"+(K+O+1)+"</div>"}C.innerHTML=G;if(F>H){F=H;C.setAttribute("val",F)}else{if(F<K){F=K;C.setAttribute("val",F)}}C.style.transform="translate3d(0,"+(8-(F-K)*2)+"em,0)";C.setAttribute("top",8-(F-K)*2+"em")}else{return}}function y(){var G=b.gearDate.querySelector(".time_hh");if(G&&G.getAttribute("val")){var E="";var D=parseInt(G.getAttribute("val"));for(var C=0;C<=23;C++){E+="<div class='tooth'>"+C+"</div>"}G.innerHTML=E;G.style.transform="translate3d(0,"+(8-D*2)+"em,0)";G.setAttribute("top",8-D*2+"em")}else{return}var H=b.gearDate.querySelector(".time_mm");if(H&&H.getAttribute("val")){var E="";var F=parseInt(H.getAttribute("val"));for(var C=0;C<=59;C++){E+="<div class='tooth'>"+C+"</div>"}H.innerHTML=E;H.style.transform="translate3d(0,"+(8-F*2)+"em,0)";H.setAttribute("top",8-F*2+"em")}else{return}}function c(D,C){if(C==1){D+=b.minY;if((D%4==0&&D%100!=0)||(D%400==0&&D%4000!=0)){return 29}else{return 28}}else{if(C==3||C==5||C==8||C==10){return 30}else{return 31}}}function n(C){if(o||p){return}p=true;C.preventDefault();var D=C.target;while(true){if(!D.classList.contains("gear")){D=D.parentElement}else{break}}clearInterval(D["int_"+D.id]);D["old_"+D.id]=C.targetTouches?C.targetTouches[0].screenY:C.pageY;D["o_t_"+D.id]=(new Date()).getTime();var E=D.getAttribute("top");if(E){D["o_d_"+D.id]=parseFloat(E.replace(/em/g,""))}else{D["o_d_"+D.id]=0}u=C}function l(C){if(!p){return}o=true;C.preventDefault();if(u){var E=u.target}else{var E=C.target}while(true){if(!E.classList.contains("gear")){E=E.parentElement}else{break}}E["new_"+E.id]=C.targetTouches?C.targetTouches[0].screenY:C.pageY;E["n_t_"+E.id]=(new Date()).getTime();var D=(E["new_"+E.id]-E["old_"+E.id])*18/370;E["pos_"+E.id]=E["o_d_"+E.id]+D;E.style.transform="translate3d(0,"+E["pos_"+E.id]+"em,0)";E.setAttribute("top",E["pos_"+E.id]+"em")}function k(C){if(!p||!o){p=o=false;return}p=o=false;C.preventDefault();if(u){var E=u.target}else{var E=C.target}while(true){if(!E.classList.contains("gear")){E=E.parentElement}else{break}}var D=(E["new_"+E.id]-E["old_"+E.id])/(E["n_t_"+E.id]-E["o_t_"+E.id]);if(Math.abs(D)<=0.2){E["spd_"+E.id]=(D<0?-0.08:0.08)}else{if(Math.abs(D)<=0.5){E["spd_"+E.id]=(D<0?-0.16:0.16)}else{E["spd_"+E.id]=D/2}}if(!E["pos_"+E.id]){E["pos_"+E.id]=0}v(E);u=null}function m(C){k(u)}function v(F){var C=0;var E=false;var D=b.maxY-b.minY+1;clearInterval(F["int_"+F.id]);F["int_"+F.id]=setInterval(function(){var R=F["pos_"+F.id];var S=F["spd_"+F.id]*Math.exp(-0.1*C);R+=S;if(Math.abs(S)>0.1){}else{S=0.1;var G=Math.round(R/2)*2;if(Math.abs(R-G)<0.05){E=true}else{if(R>G){R-=S}else{R+=S}}}if(R>8){R=8;E=true}switch(F.dataset.datetype){case"date_yy":var P=8-(D-1)*2;if(R<P){R=P;E=true}if(E){var J=Math.abs(R-8)/2;x(F,J);clearInterval(F["int_"+F.id])}break;case"date_mm":var I=b.gearDate.querySelector(".date_yy");var T=parseInt(I.getAttribute("val"));var L=11;var O=0;if(T==D-1){L=b.maxM-1}if(T==0){O=b.minM-1}var P=8-(L-O)*2;if(R<P){R=P;E=true}if(E){var J=Math.abs(R-8)/2+O;x(F,J);clearInterval(F["int_"+F.id])}break;case"date_dd":var I=b.gearDate.querySelector(".date_yy");var H=b.gearDate.querySelector(".date_mm");var T=parseInt(I.getAttribute("val"));var Q=parseInt(H.getAttribute("val"));var M=c(T,Q);var K=M-1;var N=0;if(T==D-1&&b.maxM==Q+1){K=b.maxD-1}if(T==0&&b.minM==Q+1){N=b.minD-1}var P=8-(K-N)*2;if(R<P){R=P;E=true}if(E){var J=Math.abs(R-8)/2+N;x(F,J);clearInterval(F["int_"+F.id])}break;case"time_hh":if(R<-38){R=-38;E=true}if(E){var J=Math.abs(R-8)/2;x(F,J);clearInterval(F["int_"+F.id])}break;case"time_mm":if(R<-110){R=-110;E=true}if(E){var J=Math.abs(R-8)/2;x(F,J);clearInterval(F["int_"+F.id])}break;default:}F["pos_"+F.id]=R;F.style.transform="translate3d(0,"+R+"em,0)";F.setAttribute("top",R+"em");C++},30)}function x(C,D){D=Math.round(D);C.setAttribute("val",D);if(/date/.test(C.dataset.datetype)){w()}else{y()}}function d(C){C.preventDefault();p=o=false;if(b.onClose){b.onClose()}var D=new CustomEvent("input");b.trigger.dispatchEvent(D);document.body.removeChild(b.gearDate)}function g(F){var G=b.maxY-b.minY+1;var E=parseInt(Math.round(b.gearDate.querySelector(".date_yy").getAttribute("val")));var D=parseInt(Math.round(b.gearDate.querySelector(".date_mm").getAttribute("val")))+1;D=D>9?D:"0"+D;var C=parseInt(Math.round(b.gearDate.querySelector(".date_dd").getAttribute("val")))+1;C=C>9?C:"0"+C;b.trigger.value=(E%G+b.minY)+"-"+D+"-"+C;b.value=b.trigger.value;if(b.onSubmit){b.onSubmit()}d(F)}function j(E){var F=b.maxY-b.minY+1;var D=parseInt(Math.round(b.gearDate.querySelector(".date_yy").getAttribute("val")));var C=parseInt(Math.round(b.gearDate.querySelector(".date_mm").getAttribute("val")))+1;C=C>9?C:"0"+C;b.trigger.value=(D%F+b.minY)+"-"+C;b.value=b.trigger.value;if(b.onSubmit){b.onSubmit()}d(E)}function h(F){var G=b.maxY-b.minY+1;var E=parseInt(Math.round(b.gearDate.querySelector(".date_yy").getAttribute("val")));var D=parseInt(Math.round(b.gearDate.querySelector(".date_mm").getAttribute("val")))+1;D=D>9?D:"0"+D;var C=parseInt(Math.round(b.gearDate.querySelector(".date_dd").getAttribute("val")))+1;C=C>9?C:"0"+C;var H=parseInt(Math.round(b.gearDate.querySelector(".time_hh").getAttribute("val")));H=H>9?H:"0"+H;var I=parseInt(Math.round(b.gearDate.querySelector(".time_mm").getAttribute("val")));I=I>9?I:"0"+I;b.trigger.value=(E%G+b.minY)+"-"+D+"-"+C+" "+(H.length<2?"0":"")+H+(I.length<2?":0":":")+I;b.value=b.trigger.value;if(b.onSubmit){b.onSubmit()}d(F)}function i(C){var D=parseInt(Math.round(b.gearDate.querySelector(".time_hh").getAttribute("val")));D=D>9?D:"0"+D;var E=parseInt(Math.round(b.gearDate.querySelector(".time_mm").getAttribute("val")));E=E>9?E:"0"+E;b.trigger.value=(D.length<2?"0":"")+D+(E.length<2?":0":":")+E;b.value=b.trigger.value;if(b.onSubmit){b.onSubmit()}d(C)}b.trigger.addEventListener("click",{ym:t,date:q,datetime:r,time:s}[A])}};return a})();